<!DOCTYPE html><html lang="zh-CN" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="深入生成器设计模式" /><meta name="author" content="招文桃" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="GoF 定义" /><meta property="og:description" content="GoF 定义" /><link rel="canonical" href="https://blog.zwt.io/2020/02/02/builder-pattern-in-depth/" /><meta property="og:url" content="https://blog.zwt.io/2020/02/02/builder-pattern-in-depth/" /><meta property="og:site_name" content="zwt" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-02-02T18:42:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="深入生成器设计模式" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"招文桃"},"dateModified":"2022-05-29T22:11:22+08:00","datePublished":"2020-02-02T18:42:00+08:00","description":"GoF 定义","headline":"深入生成器设计模式","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.zwt.io/2020/02/02/builder-pattern-in-depth/"},"url":"https://blog.zwt.io/2020/02/02/builder-pattern-in-depth/"}</script><title>深入生成器设计模式 | zwt</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="zwt"><meta name="application-name" content="zwt"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://tender.zwt.io/img/large.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">zwt</a></div><div class="site-subtitle font-italic">blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>深入生成器设计模式</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> </span> <span id="search-cancel" >取消</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>深入生成器设计模式</h1><div class="post-meta text-muted"> <span> 发表于 <em class="" data-ts="1580640120" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2020-02-02 </em> </span> <span> 更新于 <em class="" data-ts="1653833482" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2022-05-29 </em> </span><div class="d-flex justify-content-between"> <span> 作者 <em> zwt </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4899 字"> <em>27 分钟</em>阅读</span></div></div></div><div class="post-content"><h3 id="gof-定义"><span class="mr-2">GoF 定义</span><a href="#gof-定义" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>Separate the construction of a complex object from its representation so that the same construction processes can create different representations.</p><p>将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同表示。（中文版书里的翻译）</p></blockquote><p>Builder 在《设计模式》的中文版里边翻译为“生成器”，那我就按这个译法吧。生成器模式属于创建型模式（Creational patterns），它关注如何创建对象。当需要构建的对象比较复杂，由多个部分组成，也就说它的构造方法会有很多参数，就可以考虑使用这种模式。生成器模式认为对象的构建机制应该独立于它的组成部分（也就是属性），对象的<strong>构建过程</strong>不关注对象的<strong>组成部分</strong>。所以同一个构建过程可以构建出不同表示（属性）的对象（通过<strong>改变构建步骤</strong>）。在 GoF 书中的生成器模式 UML 类图如下：</p><p><img data-src="https://tender.zwt.io/img/builder-pattern.png" alt="Builder" data-proofer-ignore></p><p>上图中，Product 是所要创建的复杂对象，ConcreteBuilder 类表示具体的生成器，它实现了 Builder 接口，负责组装构成最终对象的各部分。ConcreteBuilder 定义了<strong>构建过程</strong>和<strong>对象组装机制</strong>，就是如何用各部分、按照怎样的步骤去构造一个 Product 对象。ConcreteBuilder 还定义了 getResult() 方法，用于返回构建好的 Product 对象。然后 Director 则是负责通过使用 Builder 接口去构建最终所需的 Product 对象，就是做指挥的。</p><p>以上是对经典的 GoF 生成器模式的解读，下面结合具体的例子加深理解。</p><h3 id="具体简单例子"><span class="mr-2">具体简单例子</span><a href="#具体简单例子" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>在这个例子里会有这些参与者：Builder, Car, MotorCycle, Product, 以及 Director。其中，Car, MotorCycle 是实现了 Builder 接口的具体类。Builder 用于构建 Product 对象的各部分，Product 则是要被创建的复杂对象（小车或摩托车）。因为 Car 和 MotorCycle 都实现了 Builder 接口，所以需要实现接口中的方法，即 <code class="language-plaintext highlighter-rouge">startUpOperations()</code>, <code class="language-plaintext highlighter-rouge">buildBody()</code>, <code class="language-plaintext highlighter-rouge">insertWheels()</code>, <code class="language-plaintext highlighter-rouge">addHeadLights()</code>, <code class="language-plaintext highlighter-rouge">endOperations()</code>, 和 <code class="language-plaintext highlighter-rouge">getVehicle()</code> 方法。前五个方法好理解，对应载具的构建过程，开始，构建车身，装轮子，装头灯，收尾。而 <code class="language-plaintext highlighter-rouge">getVehicle()</code> 方法，就是返回已构建好的载具。 然后还有 Director，它调用同一个 <code class="language-plaintext highlighter-rouge">construct()</code> 方法去构建不同类型的载具。这个具体例子的类图如下：</p><p><img data-src="https://tender.zwt.io/img/builder-pattern-vehicles.png" alt="builder-pattern-vehicles" data-proofer-ignore></p><h4 id="代码实现"><span class="mr-2">代码实现</span><a href="#代码实现" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">java.util.LinkedList</span><span class="o">;</span>

<span class="c1">// 公共接口</span>
<span class="kd">interface</span> <span class="nc">Builder</span> <span class="o">{</span>
	<span class="kt">void</span> <span class="nf">startUpOperations</span><span class="o">();</span>
	<span class="kt">void</span> <span class="nf">buildBody</span><span class="o">();</span>
	<span class="kt">void</span> <span class="nf">insertWheels</span><span class="o">();</span>
	<span class="kt">void</span> <span class="nf">addHeadlights</span><span class="o">();</span>
	<span class="kt">void</span> <span class="nf">endOperations</span><span class="o">();</span>

	<span class="cm">/* 用于获取已经构建好的对象的方法。*/</span>
	<span class="nc">Product</span> <span class="nf">getVehicle</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// Car 类</span>
<span class="kd">class</span> <span class="nc">Car</span> <span class="kd">implements</span> <span class="nc">Builder</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">brandName</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">Product</span> <span class="n">product</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Car</span><span class="o">(</span><span class="nc">String</span> <span class="n">brand</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">product</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Product</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">brandName</span> <span class="o">=</span> <span class="n">brand</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">startUpOperations</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">// 开始就设置品牌名称</span>
		<span class="n">product</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Car model is :%s"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">brandName</span><span class="o">));</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildBody</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">product</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"This is a body of a Car"</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">insertWheels</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">product</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"4 wheels are added"</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addHeadlights</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">product</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"2 Headlights are added"</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">endOperations</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Nothing in this case</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">Product</span> <span class="nf">getVehicle</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">product</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Motorcycle 类</span>
<span class="kd">class</span> <span class="nc">MotorCycle</span> <span class="kd">implements</span> <span class="nc">Builder</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">brandName</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">Product</span> <span class="n">product</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">MotorCycle</span><span class="o">(</span><span class="nc">String</span> <span class="n">brand</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">product</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Product</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">brandName</span> <span class="o">=</span> <span class="n">brand</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">startUpOperations</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Nothing in this case</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildBody</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">product</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"This is a body of a Motorcycle"</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">insertWheels</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">product</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"2 wheels are added"</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addHeadlights</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">product</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"1 Headlights are added"</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">endOperations</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">// 添加品牌名称作为收尾</span>
		<span class="n">product</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Motorcycle model is :%s"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">brandName</span><span class="o">));</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">Product</span> <span class="nf">getVehicle</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">product</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Product 类 </span>
<span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
	<span class="cm">/*
	 * 你可以使用任何数据结构，这里使用
	 * LinkedList&lt;String&gt; 
	 */</span>
	<span class="kd">private</span> <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">parts</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Product</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">parts</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">String</span> <span class="n">part</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// 添加部件</span>
		<span class="n">parts</span><span class="o">.</span><span class="na">addLast</span><span class="o">(</span><span class="n">part</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">showProduct</span><span class="o">()</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\nProduct completed as below :"</span><span class="o">);</span>
		<span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">part</span> <span class="o">:</span> <span class="n">parts</span><span class="o">)</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">part</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Director 类 </span>
<span class="kd">class</span> <span class="nc">Director</span> <span class="o">{</span>
	<span class="nc">Builder</span> <span class="n">builder</span><span class="o">;</span>

	<span class="c1">// Director 知道如何使用 builder 以及调用步骤。</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">construct</span><span class="o">(</span><span class="nc">Builder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">builder</span> <span class="o">=</span> <span class="n">builder</span><span class="o">;</span>
		<span class="n">builder</span><span class="o">.</span><span class="na">startUpOperations</span><span class="o">();</span>
		<span class="n">builder</span><span class="o">.</span><span class="na">buildBody</span><span class="o">();</span>
		<span class="n">builder</span><span class="o">.</span><span class="na">insertWheels</span><span class="o">();</span>
		<span class="n">builder</span><span class="o">.</span><span class="na">addHeadlights</span><span class="o">();</span>
		<span class="n">builder</span><span class="o">.</span><span class="na">endOperations</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BuilderPatternExample</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"***Builder Pattern Demo***"</span><span class="o">);</span>
		<span class="nc">Director</span> <span class="n">director</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Director</span><span class="o">();</span>

		<span class="nc">Builder</span> <span class="n">fordCar</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Car</span><span class="o">(</span><span class="s">"Ford"</span><span class="o">);</span>
		<span class="nc">Builder</span> <span class="n">hondaMotorycle</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MotorCycle</span><span class="o">(</span><span class="s">"Honda"</span><span class="o">);</span>

		<span class="c1">// 造小车 Car</span>
		<span class="n">director</span><span class="o">.</span><span class="na">construct</span><span class="o">(</span><span class="n">fordCar</span><span class="o">);</span>
		<span class="nc">Product</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">fordCar</span><span class="o">.</span><span class="na">getVehicle</span><span class="o">();</span>
		<span class="n">p1</span><span class="o">.</span><span class="na">showProduct</span><span class="o">();</span>

		<span class="c1">// 造摩托 MotorCycle</span>
		<span class="n">director</span><span class="o">.</span><span class="na">construct</span><span class="o">(</span><span class="n">hondaMotorycle</span><span class="o">);</span>
		<span class="nc">Product</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">hondaMotorycle</span><span class="o">.</span><span class="na">getVehicle</span><span class="o">();</span>
		<span class="n">p2</span><span class="o">.</span><span class="na">showProduct</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p><strong>输出结果：</strong></p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="go">***Builder Pattern Demo***

Product completed as below :
Car model is :Ford
This is a body of a Car
4 wheels are added
2 Headlights are added

Product completed as below :
This is a body of a Motorcycle
2 wheels are added
1 Headlights are added
Motorcycle model is :Honda
</span></pre></table></code></div></div><h3 id="q--a"><span class="mr-2">Q &amp; A</span><a href="#q--a" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li><p>使用生成器模式有什么好处?</p><ul><li>你可以用生成器模式逐步构建复杂对象，并且可以改变构建步骤。通过隐藏构建复杂对象的细节（构建每部分的细节），加强了封装性。 Director 可以从 Builder 获取最终构建完成的 Product，在表面看了就好像只有一个方法（construct()）用于构建最终产品，其他的内部方法只是涉及构建具体的部分。<li>使用这种模式，同样的构建过程，可以产生不同的产品。<li>因为你可以改变构造步骤，所以你可以改变产品的内部表示。</ul><li><p>生成器模式的坏处？</p><ul><li>不适用于处理可变对象（mutable object），即创建后可被修改的对象。<li>可能需要写些重复代码，例如不同的具体生成器有些代码类似或重复，某些情况下可能会有不好的影响，并可能成为<em><a href="https://blog.csdn.net/jiangpingjiangping/article/details/78067595">反模式</a></em>。<li>一个具体的生成器专用于产生某类产品，所以要生产另一类产品，就需要编写一个用于该类产品的具体生成器。<li>生成器模式只有在构建比较复杂的对象时用才有优势。</ul><li><p>在上面例子中我可以使用抽象类而不是接口吗？</p><ul><li>可以的。你可以使用抽象类，而不是用接口。</ul><li><p>如何确定应该使用抽象类还是接口？</p><ul><li>如果你想要一些集中的或是默认的行为，那么抽象类是更好的选择，因为这种情况下你可以提供一些默认的实现。另一方面，使用接口则需要从零开始实现，接口定义了某些规则/契约，强调应该做什么，但不强调怎么做。还有就是如果要考虑实现多继承，接口就更合适。 如果你要给接口添加一个新的方法，那么这个接口的所有实现都需要实现这个新方法，有点麻烦。但如果在抽象类中添加一个新方法，并有默认实现，那么旧代码不受影响。在 Java 8 引入了 <code class="language-plaintext highlighter-rouge">default</code> 关键字在接口的用法，可以在接口里提供默认方法。<li>下面是抽象类更适用的场景：<ul><li>想要在多个联系紧密的类之间共享代码<li>被继承的抽象类有很多公共方法或字段，或者它们当中需要非公有访问修饰符。<li>你想使用非静态或非 <code class="language-plaintext highlighter-rouge">final</code> 字段，这样可以修改其所属对象的状态。</ul><li>接下来是使用接口更合适的场景：<ul><li>希望一些不相关的类实现你的接口。<li>指定某种数据类型的行为，但是不关心如何实现。<li>想要适用多继承。</ul></ul><li><p>上面例子中，在 Car 里，brand name 在第一步添加了，而在 MotorCycle 里， brand name 在最后一步添加，这是故意的吗？</p><p>是的。这是为了说明，每种具体生成器可以自由决定如何产生最终产品。</p><li><p>为什么使用单独一个类作为 Director？应该可以使用客户端代码（client code）充当 Director 的角色啊。</p><p>这方面没有限制。上面的代码例子，将 Director 角色与客户端代码分离，但是接下来的例子会直接适用客户端代码做 Director。</p><li><p>客户端代码（client code）是什么意思？</p><p>包含 main() 方法的类就是客户端代码（client code）。在 <em>Effective Java</em> 一书的第 4 页，有三段话讲了术语 <em>exported API</em> 以及 a <em>client</em> of the API. 引用如下：</p><blockquote><p>This book uses a few technical terms that are not defined in <em>The Java Language Specification</em>. The term <em>exported API</em>, or simply <em>API</em>, refers to the classes, interfaces, constructors, members, and serialized forms by which a programmer accesses a class, interface, or package. (The term <em>API</em>, which is short for <em>application programming interface</em>, is used in preference to the otherwise preferable term <em>interface</em> to avoid confusion with the language construct of that name.) A programmer who writes a program that uses an API is referred to as a <em>user</em> of the API. A class whose implementation uses an API is a <em>client</em> of the API.</p><p>Classes, interfaces, constructors, members, and serialized forms are collectively known as <em>API elements</em>. An exported API consists of the API elements that are accessible outside of the package that defines the API. These are the API elements that any client can use and the author of the API commits to support. Not coincidentally, they are also the elements for which the Javadoc utility generates documentation in its default mode of operation. Loosely speaking, the exported API of a package consists of the public and protected members and constructors of every public class or interface in the package.</p><p>In Java 9, a <em>module system</em> was added to the platform. If a library makes use of the module system, its exported API is the union of the exported APIs of all the packages exported by the library’s module declaration.</p></blockquote><li><p>前面提到改变构建步骤。能否演示一下通过改变构建步骤产生不同的最终产品？</p><p>下面的例子给出演示。</p></ol><h3 id="改进版例子"><span class="mr-2">改进版例子</span><a href="#改进版例子" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>改进版例子做了如下修改：</p><ul><li>这次只关注 Car 作为最终产品。<li>定制 Car 的构建步骤包含这些：<ul><li>开始的消息（startUpMessage)。<li>处理结束消息（endOperationsMessage）<li>确定车身材料（bodyType）<li>车轮数量（noOfWheels）<li>车头灯数量（noOfHeadLights）</ul><li>客户端代码同时充当了 Director 的角色。<li>生成器的接口被重命名为 ModifiedBuilder， 除 constructCar() 和 getConstructedCar() 方法外，接口中的其他方法的返回类型都是 ModifiedBuilder，这样可以实现方法链（method chaining）。</ul><h4 id="代码实现-1"><span class="mr-2">代码实现</span><a href="#代码实现-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
</pre><td class="rouge-code"><pre><span class="c1">// 公共接口</span>
<span class="kd">interface</span> <span class="nc">ModifiedBuilder</span> <span class="o">{</span>
	<span class="cm">/*
	 * 所有这些方法的返回值类型都是 ModifiedBuilder。这样可以做链式调用
	 */</span>
	<span class="nc">ModifiedBuilder</span> <span class="nf">startUpOperations</span><span class="o">(</span><span class="nc">String</span> <span class="n">startUpMessage</span><span class="o">);</span>
	<span class="nc">ModifiedBuilder</span> <span class="nf">buildBody</span><span class="o">(</span><span class="nc">String</span> <span class="n">bodyType</span><span class="o">);</span>
	<span class="nc">ModifiedBuilder</span> <span class="nf">insertWheels</span><span class="o">(</span><span class="kt">int</span> <span class="n">noOfWheels</span><span class="o">);</span>
	<span class="nc">ModifiedBuilder</span> <span class="nf">addHeadlights</span><span class="o">(</span><span class="kt">int</span> <span class="n">noOfHeadLights</span><span class="o">);</span>
	<span class="nc">ModifiedBuilder</span> <span class="nf">endOperations</span><span class="o">(</span><span class="nc">String</span> <span class="n">endOperationsMessage</span><span class="o">);</span>

	<span class="cm">/* 组合部件制造最终产品。 */</span>
	<span class="nc">ProductClass</span> <span class="nf">constructCar</span><span class="o">();</span>

	<span class="c1">// 可选的方法：获取已构建的产品</span>
	<span class="nc">ProductClass</span> <span class="nf">getConstructedCar</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">//Car 类</span>
<span class="kd">class</span> <span class="nc">CarBuilder</span> <span class="kd">implements</span> <span class="nc">ModifiedBuilder</span> <span class="o">{</span>
    <span class="c1">// 默认起始消息</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">startUpMessage</span> <span class="o">=</span> <span class="s">"Start building the product"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">bodyType</span> <span class="o">=</span> <span class="s">"Steel"</span><span class="o">;</span> <span class="c1">// 默认车身类型</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">noOfWheels</span> <span class="o">=</span> <span class="mi">4</span><span class="o">;</span> <span class="c1">// 默认车轮数量</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">noOfHeadLights</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span> <span class="c1">// 默认车头灯数量</span>
	<span class="c1">// 默认结束消息</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">endOperationsMessage</span> <span class="o">=</span> <span class="s">"Product creation completed"</span><span class="o">;</span>
	<span class="nc">ProductClass</span> <span class="n">product</span><span class="o">;</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">ModifiedBuilder</span> <span class="nf">startUpOperations</span><span class="o">(</span><span class="nc">String</span> <span class="n">startUpMessage</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">startUpMessage</span> <span class="o">=</span> <span class="n">startUpMessage</span><span class="o">;</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">ModifiedBuilder</span> <span class="nf">buildBody</span><span class="o">(</span><span class="nc">String</span> <span class="n">bodyType</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">bodyType</span> <span class="o">=</span> <span class="n">bodyType</span><span class="o">;</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">ModifiedBuilder</span> <span class="nf">insertWheels</span><span class="o">(</span><span class="kt">int</span> <span class="n">noOfWheels</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">noOfWheels</span> <span class="o">=</span> <span class="n">noOfWheels</span><span class="o">;</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">ModifiedBuilder</span> <span class="nf">addHeadlights</span><span class="o">(</span><span class="kt">int</span> <span class="n">noOfHeadLights</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">noOfHeadLights</span> <span class="o">=</span> <span class="n">noOfHeadLights</span><span class="o">;</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">ModifiedBuilder</span> <span class="nf">endOperations</span><span class="o">(</span><span class="nc">String</span> <span class="n">endOperationsMessage</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">endOperationsMessage</span> <span class="o">=</span> <span class="n">endOperationsMessage</span><span class="o">;</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">ProductClass</span> <span class="nf">constructCar</span><span class="o">()</span> <span class="o">{</span>

		<span class="n">product</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProductClass</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">startUpMessage</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">bodyType</span><span class="o">,</span>
                                   <span class="k">this</span><span class="o">.</span><span class="na">noOfWheels</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">noOfHeadLights</span><span class="o">,</span>
				<span class="k">this</span><span class="o">.</span><span class="na">endOperationsMessage</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">product</span><span class="o">;</span>
	<span class="o">}</span>

    <span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">ProductClass</span> <span class="nf">getConstructedCar</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">product</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Product 类 </span>
<span class="kd">final</span> <span class="kd">class</span> <span class="nc">ProductClass</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">startUpMessage</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">bodyType</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">noOfWheels</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">noOfHeadLights</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">endOperationsMessage</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">ProductClass</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">startUpMessage</span><span class="o">,</span> <span class="nc">String</span> <span class="n">bodyType</span><span class="o">,</span>
                        <span class="kt">int</span> <span class="n">noOfWheels</span><span class="o">,</span> <span class="kt">int</span> <span class="n">noOfHeadLights</span><span class="o">,</span>
			<span class="nc">String</span> <span class="n">endOperationsMessage</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">startUpMessage</span> <span class="o">=</span> <span class="n">startUpMessage</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">bodyType</span> <span class="o">=</span> <span class="n">bodyType</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">noOfWheels</span> <span class="o">=</span> <span class="n">noOfWheels</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">noOfHeadLights</span> <span class="o">=</span> <span class="n">noOfHeadLights</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">endOperationsMessage</span> <span class="o">=</span> <span class="n">endOperationsMessage</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="cm">/*
	 * 没有使用 setter 方法，加强不可以变性。因为属性是私有，且没有 setter 方法，
	 * 所以不必要使用 final 关键字。
	 */</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"Product Completed as:\n startUpMessage="</span> <span class="o">+</span> 
            <span class="n">startUpMessage</span> <span class="o">+</span> <span class="s">"\n bodyType="</span> <span class="o">+</span> 
            <span class="n">bodyType</span> <span class="o">+</span> <span class="s">"\n noOfWheels="</span> <span class="o">+</span> 
            <span class="n">noOfWheels</span> <span class="o">+</span> <span class="s">"\n noOfHeadLights="</span> <span class="o">+</span> 
            <span class="n">noOfHeadLights</span> <span class="o">+</span> <span class="s">"\n endOperationsMessage="</span> <span class="o">+</span> 
            <span class="n">endOperationsMessage</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Director 类 </span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BuilderPatternModifiedExample</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"***Modified Builder Pattern Demo***"</span><span class="o">);</span>
		<span class="cm">/*
		 * 构造一个定制的小车（通过使用 builder），注意步骤：
		 * 第1步：已必要的参数获取一个 builder 对象。
		 * 第2步：使用类似 setter 的方法设置可选字段。
		 * 第3步：调用 constructCar() 方法去获取最终生成的小车。
		 */</span>
		<span class="kd">final</span> <span class="nc">ProductClass</span> <span class="n">customCar1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CarBuilder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">addHeadlights</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
            <span class="o">.</span><span class="na">insertWheels</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
            <span class="o">.</span><span class="na">buildBody</span><span class="o">(</span><span class="s">"Plastic"</span><span class="o">)</span>
			<span class="o">.</span><span class="na">constructCar</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">customCar1</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"--------------"</span><span class="o">);</span>
		<span class="cm">/*
		 * 用不同的步骤构造另一个定制小车（通过使用 builder）
		 */</span>
		<span class="nc">ModifiedBuilder</span> <span class="n">carBuilder2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CarBuilder</span><span class="o">();</span>
		<span class="kd">final</span> <span class="nc">ProductClass</span> <span class="n">customCar2</span> <span class="o">=</span> <span class="n">carBuilder2</span>
            <span class="o">.</span><span class="na">insertWheels</span><span class="o">(</span><span class="mi">7</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addHeadlights</span><span class="o">(</span><span class="mi">6</span><span class="o">)</span>
            <span class="o">.</span><span class="na">startUpOperations</span><span class="o">(</span><span class="s">"I am making my own car"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">constructCar</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">customCar2</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"--------------"</span><span class="o">);</span>
		<span class="cm">/*
		 * 错误，因为 customCar2 是 final 的
         * customCar2 = carBuilder2.insertWheels(70)
		 * .addHeadlights(6) .startUpOperations("I am making my own car")
		 * .constructCar(); System.out.println(customCar2);
		 */</span>		
		<span class="c1">// 验证 getConstructedCar() 方法</span>
        
		<span class="kd">final</span> <span class="nc">ProductClass</span> <span class="n">customCar3</span> <span class="o">=</span> <span class="n">carBuilder2</span><span class="o">.</span><span class="na">getConstructedCar</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">customCar3</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p><strong>输出结果：</strong></p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="go">***Modified Builder Pattern Demo***
Product Completed as:
startUpMessage=Start building the product
bodyType=Plastic
noOfWheels=5
noOfHeadLights=5
endOperationsMessage=Product creation completed
--------------
Product Completed as:
startUpMessage=I am making my own car
bodyType=Steel
noOfWheels=7
noOfHeadLights=6
endOperationsMessage=Product creation completed
--------------
Product Completed as:
startUpMessage=I am making my own car
bodyType=Steel
noOfWheels=7
noOfHeadLights=6
endOperationsMessage=Product creation completed
</span></pre></table></code></div></div><p>在改进版例子中，第 124 行，构建 <code class="language-plaintext highlighter-rouge">customCar1</code>，逐步调用了 <code class="language-plaintext highlighter-rouge">addHeadLights()</code>, <code class="language-plaintext highlighter-rouge">insertWheels()</code>, <code class="language-plaintext highlighter-rouge">buildBody()</code> 方法。 然后当构建 <code class="language-plaintext highlighter-rouge">customCar2</code> 时，方法的调用顺序不同了，而没调用的方法，会取默认值。</p><h3 id="q--a-1"><span class="mr-2">Q &amp; A</span><a href="#q--a-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li><p>改进版例子中客户端代码用到 <code class="language-plaintext highlighter-rouge">final</code> 关键字，但是 <code class="language-plaintext highlighter-rouge">ProductClass</code> 的属性却没有用 <code class="language-plaintext highlighter-rouge">final</code> 关键字，为什么？</p><p>在客户端代码使用 <code class="language-plaintext highlighter-rouge">final</code> 关键字是为了提高不可修改性（immutability），但是在 <code class="language-plaintext highlighter-rouge">ProductClass</code> 属性已经是私有且那个类没有 setter 方法，所以已经是不可修改了，不需要使用 <code class="language-plaintext highlighter-rouge">final</code> 关键字。</p><li><p>不可修改的对象有什么好处？</p><p>这样的对象一旦构建完成，就可以安全地共享，更重要的是它们是线程安全的（thread-safe），所以在多线程环境中省去了很多同步操作。</p><li><p>何时应该考虑使用生成器模式？</p><p>当你需要创建一个复杂的对象，涉及到很多步骤，而且被创建的对象需要是不可修改的对象，可以考虑使用生成器模式。</p></ol><h3 id="补充"><span class="mr-2">补充</span><a href="#补充" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="静态嵌套类链式调用"><span class="mr-2">静态嵌套类，链式调用</span><a href="#静态嵌套类链式调用" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>这里补充 Effective Java 第三版里边 Item 2 所讲的 <strong>Consider a builder when faced with many constructor parameters</strong> 的代码例子，因为觉得这里面的例子稍微高级一点，应用到静态嵌套类（不知道这样翻译准不准确，英文是 Static nested class）。 在说完 Telescoping constructor pattern (does not scale well!) 和 JavaBeans Pattern (allows inconsistency, mandates mutability) 缺点之后，Joshua Bloch 给出了一种 Builder Pattern，代码如下：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="c1">// Builder Pattern</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NutritionFacts</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servingSize</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">fat</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">sodium</span><span class="o">;</span> <span class="c1">// 钠</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">carbohydrate</span><span class="o">;</span> <span class="c1">// 碳水化合物</span>
    
    <span class="c1">// 用 Static nested class 作为 Builder</span>
    <span class="c1">// 放在这里面可以 convey 一种 ownership，</span>
    <span class="c1">// 说明这个 Builder 用于生成 NutritionFacts</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="o">{</span>
        <span class="c1">// Required parameters 必须的参数</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servingSize</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">;</span>
        
        <span class="c1">// Optional parameters - initialized to default values</span>
        <span class="c1">// 可选参数，初始化为默认值</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">calories</span>     <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">fat</span>          <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">sodium</span>       <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">carbohydrate</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        
        <span class="kd">public</span> <span class="nf">Builder</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">servingSize</span> <span class="o">=</span> <span class="n">servingSize</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">servings</span>    <span class="o">=</span> <span class="n">servings</span><span class="o">;</span>
        <span class="o">}</span>
        
        <span class="c1">// 表示各个构造步骤，返回 Builder 自身引用，形成 fluent API 链式调用</span>
        <span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">calories</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span>
        	<span class="o">{</span> <span class="n">calories</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>  <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
        <span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">fat</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span>
        	<span class="o">{</span> <span class="n">fat</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>  <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
        <span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">sodium</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span>
        	<span class="o">{</span> <span class="n">sodium</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>  <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>        
        <span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">carbohydrate</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span>
        	<span class="o">{</span> <span class="n">carbohydrate</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>  <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
        
        <span class="c1">// 返回最终产品</span>
        <span class="kd">public</span> <span class="nc">NutritionFacts</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="c1">// 私有构造函数</span>
    <span class="kd">private</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="nc">Builder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">servingSize</span>  <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">servingSize</span><span class="o">;</span>
        <span class="n">servings</span>     <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">servings</span><span class="o">;</span>
        <span class="n">calories</span>     <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">calories</span><span class="o">;</span>
        <span class="n">fat</span>          <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">fat</span><span class="o">;</span>
        <span class="n">sodium</span>       <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">sodium</span><span class="o">;</span>
        <span class="n">carbohydrate</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">carbohydrate</span><span class="o">;</span>
    <span class="o">}</span>
        
<span class="o">}</span>
</pre></table></code></div></div><p>按上面的 Builder 实现，客户端代码可以这样写：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nc">NutritionFacts</span> <span class="n">cocaCola</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NutritionFacts</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="mi">240</span><span class="o">,</span> <span class="mi">8</span><span class="o">).</span>
    <span class="n">calories</span><span class="o">(</span><span class="mi">100</span><span class="o">).</span><span class="na">sodium</span><span class="o">(</span><span class="mi">35</span><span class="o">).</span><span class="na">carbohydrate</span><span class="o">(</span><span class="mi">27</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</pre></table></code></div></div><p>这样的链式调用，易写、易读，模仿了像 Python 或 Scala 中的命名参数（named optional parameters).</p><h4 id="适用于类继承体系结构"><span class="mr-2">适用于类继承体系结构</span><a href="#适用于类继承体系结构" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>即抽象类有抽象 builder，具体类有具体的 builder，例如以下代码是一个抽象类，代表各种披萨：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c1">// Builder pattern for class hierarchies</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Pizza</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Topping</span> <span class="o">{</span> <span class="no">HAM</span><span class="o">,</span> <span class="no">MUSHROOM</span><span class="o">,</span> <span class="no">ONION</span><span class="o">,</span> <span class="no">PEPPER</span><span class="o">,</span> <span class="no">SAUSAGE</span> <span class="o">}</span>
    <span class="kd">final</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Topping</span><span class="o">&gt;</span> <span class="n">toppings</span><span class="o">;</span>
    
    <span class="kd">abstract</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Builder</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Builder</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
        <span class="nc">EnumSet</span><span class="o">&lt;</span><span class="nc">Topping</span><span class="o">&gt;</span> <span class="n">toppings</span> <span class="o">=</span> <span class="nc">EnumSet</span><span class="o">.</span><span class="na">noneOf</span><span class="o">(</span><span class="nc">Topping</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kd">public</span> <span class="no">T</span> <span class="nf">addTopping</span><span class="o">(</span><span class="nc">Topping</span> <span class="n">topping</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">toppings</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">topping</span><span class="o">));</span>
            <span class="k">return</span> <span class="nf">self</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">abstract</span> <span class="nc">Pizza</span> <span class="nf">build</span><span class="o">();</span>
        
        <span class="c1">// Subclasses must override this method to return "this"</span>
        <span class="kd">protected</span> <span class="kd">abstract</span> <span class="no">T</span> <span class="nf">self</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="nc">Pizza</span><span class="o">(</span><span class="nc">Builder</span><span class="o">&lt;?&gt;</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">toppings</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">toppings</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>  <span class="c1">// See Item 50</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>上面的 <code class="language-plaintext highlighter-rouge">Pizza.Builder</code> 是带有<em>递归类型参数</em>的泛型，加上抽象的 <code class="language-plaintext highlighter-rouge">self</code> 方法，可以允许子类实现方法链式调用。因为 Java 没有 self 类型，这种做法是模仿 self 类型的习惯。(This workaround for the fact that Java lacks a self type is known as the <strong>simulated self-type idiom</strong>.)</p><p>然后接下来是两个具体的 <code class="language-plaintext highlighter-rouge">Pizza</code> 子类：</p><p>纽约披萨：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NyPizza</span> <span class="kd">extends</span> <span class="nc">Pizza</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Size</span> <span class="o">{</span> <span class="no">SMALL</span><span class="o">,</span> <span class="no">MEDIUM</span><span class="o">,</span> <span class="no">LARGE</span> <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Size</span> <span class="n">size</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="kd">extends</span> <span class="nc">Pizza</span><span class="o">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="nc">Builder</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Size</span> <span class="n">size</span><span class="o">;</span>
        
        <span class="c1">// covariant return typing</span>
        <span class="kd">public</span> <span class="nf">Builder</span><span class="o">(</span><span class="nc">Size</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">=</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">requiresNonNull</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nd">@Override</span> <span class="kd">public</span> <span class="nc">NyPizza</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">NyPizza</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nd">@Override</span> <span class="kd">protected</span> <span class="nc">Builder</span> <span class="nf">self</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="nf">NyPizza</span><span class="o">(</span><span class="nc">Builder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">builder</span><span class="o">);</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>意式披萨：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Calzone</span> <span class="kd">extends</span> <span class="nc">Pizza</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">sauceInside</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="kd">extends</span> <span class="nc">Pizza</span><span class="o">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="nc">Builder</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">sanceInside</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// Default</span>
        
        <span class="c1">// covariant return typing</span>
        <span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">sauceInside</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">sauceInside</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@Override</span> <span class="kd">public</span> <span class="nc">Calzone</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">Calzone</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nd">@Override</span> <span class="kd">protected</span> <span class="nc">Builder</span> <span class="nf">self</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="nf">Calzone</span><span class="o">(</span><span class="nc">Builder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">builder</span><span class="o">);</span>
        <span class="n">sauceInside</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">sauceInside</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>然后客户端代码看起来是这样的：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nc">NyPizza</span> <span class="n">pizza</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NyPizza</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="no">SAMLL</span><span class="o">)</span>
    <span class="o">.</span><span class="na">addTopping</span><span class="o">(</span><span class="no">SAUSAGE</span><span class="o">).</span><span class="na">addTopping</span><span class="o">(</span><span class="no">ONION</span><span class="o">).</span><span class="na">buid</span><span class="o">();</span>
<span class="nc">Calzone</span> <span class="n">calzone</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Calzone</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">addTopping</span><span class="o">(</span><span class="no">HAM</span><span class="o">).</span><span class="na">sauceInside</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
</pre></table></code></div></div><h3 id="总结"><span class="mr-2">总结</span><a href="#总结" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>总的来说，当一个类的构造函数或者静态工厂有较多的参数时，生成器模式是一种好的选择，特别是有些参数是可选的，或者类型是相同的。【完结】</p><h3 id="参考"><span class="mr-2">参考</span><a href="#参考" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>[Gamma95] Gamma, Erich, Richard Helm, Ralph Johnson, and John Vlissides. 1995. <em>Design Patterns: Elements of Reusable Object-Oriented Software.</em> Reading, MA: Addison-Wesley. ISBN: 0201633612<li>Sarcar, Vaskaran. <em>Design Patterns in Java, Second Edition.</em> Apress, 2019<li><a href="https://springframework.guru/gang-of-four-design-patterns/builder-pattern/">Springframework guru: Builder Pattern</a><li>Joshua Block. <em>Effective Java, Third Edition.</em> Addison-Wesley, 2018<li><a href="https://blog.csdn.net/jiangpingjiangping/article/details/78067595">设计模式杂谈——模式与反模式之争</a></ul><blockquote><p>更新记录：</p><p>2020年3月13日 下午3点13分 修正一些错别字，整理一下代码格式，和替换注释为中文。</p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/design-pattern/" class="post-tag no-text-decoration" >Design Pattern</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="post-tag no-text-decoration" >设计模式</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%E6%B7%B1%E5%85%A5%E7%94%9F%E6%88%90%E5%99%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F+-+zwt&url=https%3A%2F%2Fblog.zwt.io%2F2020%2F02%2F02%2Fbuilder-pattern-in-depth%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%E6%B7%B1%E5%85%A5%E7%94%9F%E6%88%90%E5%99%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F+-+zwt&u=https%3A%2F%2Fblog.zwt.io%2F2020%2F02%2F02%2Fbuilder-pattern-in-depth%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fblog.zwt.io%2F2020%2F02%2F02%2Fbuilder-pattern-in-depth%2F&text=%E6%B7%B1%E5%85%A5%E7%94%9F%E6%88%90%E5%99%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F+-+zwt" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" data-title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">最近更新</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/linux/2023/08/04/creating-pve-debian-cloud-init-template/">创建 PVE debian cloud-init 模板</a><li><a href="/linux/2023/03/20/esxi-cloud-init-example/">在 ESXi 使用 Cloud-init 安装系统的例子</a><li><a href="/java/2023/03/23/maven-default-http-blocker-override/">允许高版本 maven 使用 http 私有仓库</a><li><a href="/minio/2022/07/25/install-minio-on-ubuntu/">在 Ubuntu 安装 MinIO</a><li><a href="/virtualization/2023/02/24/proxmox-cloud-init-images/">在 pve 使用 cloud-init 镜像</a></ul></div><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/spring-boot/">Spring Boot</a> <a class="post-tag" href="/tags/reactive/">Reactive</a> <a class="post-tag" href="/tags/javafx/">JavaFX</a> <a class="post-tag" href="/tags/oca/">OCA</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/tutorial/">Tutorial</a> <a class="post-tag" href="/tags/rsocket/">RSocket</a> <a class="post-tag" href="/tags/%E6%95%99%E7%A8%8B/">教程</a> <a class="post-tag" href="/tags/%E7%AC%94%E8%AF%95%E9%9D%A2%E8%AF%95/">笔试面试</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">文章内容</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>相关文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/linux/2023/08/04/creating-pve-debian-cloud-init-template/"><div class="card-body"> <em class="small" data-ts="1691119320" data-df="YYYY-MM-DD" > 2023-08-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>创建 PVE debian cloud-init 模板</h3><div class="text-muted small"><p> 本文记录如何在 PVE 8.0.3 环境使用 debian 12 bookworm 的 cloud-init 镜像创建虚拟机模板，并进行一些定制化，例如预装一些常用软件包，修改 apt 源为国内镜像，和修改系统时区。 下载镜像 搜索 debian cloud init image 找到下载页面。 有好几种镜像种类，看到页面描述：”generic: Should run in any ...</p></div></div></a></div><div class="card"> <a href="/java/2023/03/23/maven-default-http-blocker-override/"><div class="card-body"> <em class="small" data-ts="1679565480" data-df="YYYY-MM-DD" > 2023-03-23 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>允许高版本 maven 使用 http 私有仓库</h3><div class="text-muted small"><p> 高版本的 maven 默认会阻止使用 http 协议，仅支持 https 协议。但是如果本地网络私有仓库有 maven 的包，需要用到 http 的 repository 例如在工程的 pom.xml 文件里面，假设是这样的： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 &amp;lt;repositories&amp;gt; &amp;lt;repository&amp;gt; ...</p></div></div></a></div><div class="card"> <a href="/linux/2023/03/20/esxi-cloud-init-example/"><div class="card-body"> <em class="small" data-ts="1679321760" data-df="YYYY-MM-DD" > 2023-03-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>在 ESXi 使用 Cloud-init 安装系统的例子</h3><div class="text-muted small"><p> 在 pve 使用 cloud-init 镜像 相对来说简单一些，要在 ESXi 中使用 cloud-init 镜像，步骤就繁琐一点。本文记录一下在 ESXi-7.0U3f-20036589-standard 中使用 cloud-init 镜像安装并配置 Ubuntu Server Jammy 的步骤。 下载 VMDK 文件 首先去 Ubuntu 的 cloud-images 网站下载对应...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/2020/02/01/spring-classes/" class="btn btn-outline-primary" prompt="上一篇"><p>Spring Boot的类</p></a> <a href="/2020/02/04/inner-class/" class="btn btn-outline-primary" prompt="下一篇"><p>Java 内部类</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="">zwt</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0"> 本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/spring-boot/">Spring Boot</a> <a class="post-tag" href="/tags/reactive/">Reactive</a> <a class="post-tag" href="/tags/javafx/">JavaFX</a> <a class="post-tag" href="/tags/oca/">OCA</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/tutorial/">Tutorial</a> <a class="post-tag" href="/tags/rsocket/">RSocket</a> <a class="post-tag" href="/tags/%E6%95%99%E7%A8%8B/">教程</a> <a class="post-tag" href="/tags/%E7%AC%94%E8%AF%95%E9%9D%A2%E8%AF%95/">笔试面试</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/zh.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
